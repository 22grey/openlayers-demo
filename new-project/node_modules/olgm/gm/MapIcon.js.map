{"version":3,"file":"MapIcon.js","sources":["../../../src/olgm/gm/MapIcon.js"],"sourcesContent":["/**\n * @module olgm/gm/MapIcon\n */\nimport MapElement from './MapElement.js';\n\n/**\n * @typedef {Object} Options\n * @property {boolean} [useCanvas] Whether or not we should draw on canvases when we can, instead of using the Google Maps API. This fixes z-index issues with labels on margers\n */\n\n/**\n * @classdesc\n * @api\n */\nclass MapIcon extends MapElement {\n  /**\n   * Creates a new map icon\n   * @param {module:ol/style/Icon} imageStyle ol3 style properties\n   * @param {Object<string, *>=} opt_options Optional properties to set.\n   */\n  constructor(imageStyle, opt_options) {\n    super();\n\n    /**\n     * This object contains the ol3 style properties for the icon. We keep\n     * it as an object because its properties can change, for example the size\n     * is only defined after the image is done loading.\n     * @type {module:ol/style/Icon}\n     * @private\n     */\n    this.imageStyle_ = imageStyle;\n\n    this.setValues(opt_options);\n  }\n\n\n  /**\n   * Listen to property changes and react accordingly\n   * @param {string} prop property\n   * @api\n   * @override\n   */\n  changed(prop) {\n    switch (prop) {\n      case 'maxZoom':\n      case 'minZoom':\n      case 'offsetX':\n      case 'offsetY':\n      case 'position':\n        this.draw();\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Rotate a point around the origin by a given angle expressed as a (cos, sin) pair.\n   * @private\n   */\n\n  rotate_(cosTheta, sinTheta, x, y) {\n    return [x * cosTheta - y * sinTheta, x * sinTheta + y * cosTheta];\n  }\n\n  /**\n   * Draws the icon to the canvas 2d context.\n   * @private\n   */\n  drawCanvas_() {\n    const canvas = this.canvas_;\n    if (!canvas) {\n      return;\n    }\n\n    const image = this.imageStyle_.getImage(1);\n    if (!image) {\n      return;\n    }\n\n    const style = canvas.style;\n\n    style.zIndex = /** @type {number} */ (this.get('zIndex'));\n\n    const scale = this.imageStyle_.getScale() || 1;\n    const anchor = this.imageStyle_.getAnchor() || [0, 0];\n    const rotation = this.imageStyle_.getRotation() || 0;\n    const opacity = this.imageStyle_.getOpacity() || 1;\n\n    const offsetX = anchor[0] * scale;\n    const offsetY = anchor[1] * scale;\n\n    let w_2 = image.width * scale * 0.5;\n    let h_2 = image.height * scale * 0.5;\n\n    w_2 += Math.abs(w_2 - offsetX);\n    h_2 += Math.abs(h_2 - offsetY);\n\n    const cosTheta = Math.cos(rotation);\n    const sinTheta = Math.sin(rotation);\n\n    const p1 = this.rotate_(cosTheta, sinTheta, -w_2, -h_2);\n    const p2 = this.rotate_(cosTheta, sinTheta, +w_2, -h_2);\n    const p3 = this.rotate_(cosTheta, sinTheta, -w_2, +h_2);\n    const p4 = this.rotate_(cosTheta, sinTheta, +w_2, +h_2);\n\n    const minX = Math.min(p1[0], p2[0], p3[0], p4[0]);\n    const maxX = Math.max(p1[0], p2[0], p3[0], p4[0]);\n    const minY = Math.min(p1[1], p2[1], p3[1], p4[1]);\n    const maxY = Math.max(p1[1], p2[1], p3[1], p4[1]);\n\n    canvas.width = Math.round(maxX - minX);\n    canvas.height = Math.round(maxY - minY);\n\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const x = canvas.width / 2 - offsetX;\n    const y = canvas.height / 2 - offsetY;\n\n    ctx.translate(x + offsetX, y + offsetY);\n    ctx.rotate(rotation);\n    ctx.translate(-x - offsetX, -y - offsetY);\n    ctx.globalAlpha = opacity;\n\n    ctx.drawImage(image, x, y,\n      image.width * scale, image.height * scale);\n  }\n\n  /**\n   * Manage feature being added to the map\n   * @api\n   * @override\n   */\n  onAdd() {\n    const canvas = this.canvas_ = document.createElement('canvas');\n    const style = canvas.style;\n    style.position = 'absolute';\n\n    this.drawCanvas_();\n\n    const panes = this.getPanes();\n    if (panes) {\n      let pane = this.get('olgm_pane');\n      if (pane) {\n        pane = panes[pane];\n      }\n      if (!pane) {\n        pane = panes.markerLayer;\n      }\n\n      pane.appendChild(canvas);\n    }\n  }\n}\nexport default MapIcon;\n"],"names":["super","const","let"],"mappings":"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"}